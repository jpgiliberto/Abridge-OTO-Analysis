---
title: "Abridge AI Scribe in OTO"
author: "JP Giliberto and Jen Ren"
format: html
---

## Wrangle
### Load Packages
```{r}
#|code-fold: true
#|warning: false
#|warning: false

#loading standard packages for data wrangle and visualization. JPG just commented out packages I don't think we will use. 
library (tidyverse)
library(readr)
library (lubridate)
library(readxl)
library(forcats)
library(scales)
library(ggthemes)
library(ggrepel)
library(janitor)
library(gt)
#library(ggridges)
library(lme4)
library(lmerTest)
library(broom.mixed)
#library(ggsignif)

```

### Load DeID data

```{r}
#|code-fold: true
#|warning: false
#|warning: false


SessionsRaw <- read_csv("Raw Data DeID/Abridge Sessions 09 25 to 11 25.csv") |> 
  select(2:4)
SignalRaw <- read_csv("Raw Data DeID/Signal Data 12 22 to 11 25.csv") |> 
  select(StartDate = `Reporting Period Start Date`, EndDate = `Reporting Period End Date`, 4:8) |> 
  mutate(GroupData = case_when(StudyID == "ID928" & StartDate >"2025-02-01" ~ "AIScribe",
                               StudyID == "ID928" & StartDate <"2025-01-01" ~ "Control",
                               StudyID == "ID928"  ~ "Transition",
                               StartDate > "2025-9-01"~ "AIScribe",
                               StartDate < "2025-08-15" ~"Control",
                               T ~"Transition")
                )
SurveyRaw <- read_csv("Raw Data DeID/Survey - Baseline.csv") |> 
  select(2:57)

```

### Create or Load Keys
```{r}
KeyIDRole <- read_csv("Participant Key ID.csv") |> 
  select(2:3)

#High vs Low Users. we can discuss best way to do that. median 106
KeyUserHigh <- SessionsRaw |> 
  group_by(StudyID) |> 
  summarise(n = sum(`Abridge Sessions`, na.rm = T)) |> 
  #12/20 median number of total usage was 105 will need to update
  mutate(HighUser = n>105) |> 
  select(-n)
```

## Data Exploration Visualization

```{r}
Pajama <- SignalRaw |> 
  filter(Metric == "Pajama Time") |> 
  left_join(KeyUserHigh)

ggplot(Pajama, aes(x = StartDate, y = Value))+
  geom_point(aes(color=GroupData), size = 1.5)+
  geom_line(color = "grey60")+
  facet_grid(StudyID~HighUser, scales = "free_y",)+
  ylab("PJ Time per Scheduled Day")+
  theme_bw()

ggsave ("PJ Time All Users.jpg", device = "jpeg",path = "C://Users//jpgil//OneDrive//Research - Primary//Epic//Abridge OTO//Abridge OTO Analysis//Figures", dpi = "retina", units = "in", height = 12 ,width = 8  )


```


